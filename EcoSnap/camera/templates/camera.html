<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<script>

    function startup() {
        var startButton = document.getElementById("start");
        var captureButton = document.getElementById("capture");
        var myStream = document.getElementById("myStream");
        var myCanvas = document.getElementById("myCanvas");
        var myPhoto = document.getElementById("myPhoto");
        var img_link = document.getElementById("img_link");

        navigator.mediaDevices.getUserMedia({ video: true })
            .then(function (stream) {
                myStream.srcObject = stream;
                myStream.play();
            })

        clearPic();
    }

    function takePicture() {
        var ctx = myCanvas.getContext('2d');
        myCanvas.width = 200;
        myCanvas.height = 200;
        ctx.drawImage(myStream, 0, 0, 200, 200);

        img_link.value = myCanvas.toDataURL('image/png');
        let data = myCanvas.toDataURL('image/png');
        myPhoto.src = data;
    }

    function clearPic() {
        var ctx = myCanvas.getContext('2d');
        ctx.fillStyle = "black";
        ctx.fillRect(0, 0, myCanvas.width, myCanvas.height);
        myPhoto.setAttribute('src', myCanvas.toDataURL('image/png'));
    }

    window.addEventListener('load', startup, false);

</script>

<body>
    <!-- <h1>EcoSnap</h1> -->
    {% extends "base.html"%}

    {% block content %}
    <div>
        <div>
            <h2>Video Stream</h2>
            <!-- <button id="start">Stream</button> -->
            <button id="capture" onclick="takePicture()">Picture</button>
            <button onclick="clearPic()">Clear</button>
            <video src="" id="myStream"></video>
            <canvas style="visibility: hidden;" id="myCanvas"></canvas>
        </div>
        <form method="POST">
            <!-- {% csrf_token %} bypassing it-->
            <img id="myPhoto" src="" alt="The Pic" name="myPic">
            <textarea name="img_link" id="img_link" cols="100" rows="50"></textarea>
            <button type="submit">Check!</button>
        </form>
    </div>
    {% endblock %}

</body>

</html>